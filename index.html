<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recebimento de Produtos</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Roboto Mono', monospace;
  background: linear-gradient(135deg, #1a1a1a 0%, #2d1b1b 100%);
  min-height: 100vh;
  color: #333;
}

.cabecalho {
  background: linear-gradient(90deg, #8B0000 0%, #B22222 100%);
  color: white;
  padding: 20px 30px;
  margin: -30px -30px 30px -30px;
  border-radius: 8px 8px 0 0;
  box-shadow: 0 4px 12px rgba(139, 0, 0, 0.3);
}

.cabecalho h1 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 5px;
  letter-spacing: 1px;
}

.data-hora { font-size: 14px; opacity: 0.9; }

.btn-voltar {
  background: rgba(255,255,255,0.2);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
  padding: 8px 16px;
  font-size: 14px;
  cursor: pointer;
  border-radius: 4px;
  float: right;
}

.btn-voltar:hover { background: rgba(255,255,255,0.3); }

.tela {
  max-width: 1000px;
  margin: 0 auto;
  background: white;
  min-height: 80vh;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
}

.botoes-topo {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  justify-content: center;
  flex-wrap: wrap;
}

button {
  background: linear-gradient(145deg, #B22222, #8B0000);
  color: white;
  border: none;
  padding: 12px 20px;
  font-family: 'Roboto Mono', monospace;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(139, 0, 0, 0.3);
  letter-spacing: 0.5px;
  white-space: nowrap;
}

button:hover {
  background: linear-gradient(145deg, #A52A2A, #7D0000);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(139, 0, 0, 0.4);
}

.btn-primary {
  background: linear-gradient(145deg, #DC143C, #B22222);
  padding: 16px 32px;
  font-size: 17px;
  width: 100%;
}

.btn-salvar {
  background: linear-gradient(145deg, #28a745, #20c997);
}

.btn-salvar:hover {
  background: linear-gradient(145deg, #218838, #1ea085);
}

.btn-imprimir {
  background: linear-gradient(145deg, #007bff, #0056b3);
}

.btn-imprimir:hover {
  background: linear-gradient(145deg, #0069d9, #004085);
}

.btn-download-pdf {
  background: linear-gradient(145deg, #ffc107, #e0a800);
  color: #212529;
}

.btn-download-pdf:hover {
  background: linear-gradient(145deg, #e0a61f, #d39e00);
  color: #212529;
}

.btn-limpar-tudo {
  background: linear-gradient(145deg, #6c757d, #495057);
}

.btn-limpar-tudo:hover {
  background: linear-gradient(145deg, #5a6268, #3d4047);
}

.btn-editar { 
  background: #007bff; 
  padding: 8px 16px;
  font-size: 14px;
  margin-right: 10px;
}

.btn-editar:hover { background: #0056b3; }

.btn-excluir { 
  background: #dc3545; 
  padding: 8px 16px;
  font-size: 14px;
}

.btn-excluir:hover { background: #c82333; }

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

.form-group { display: flex; flex-direction: column; }
.form-group.full-width { grid-column: 1 / -1; }

.form-group label {
  font-weight: 500;
  color: #2c2c2c;
  margin-bottom: 8px;
  font-size: 14px;
  letter-spacing: 0.3px;
}

input[type="text"], input[type="number"] {
  padding: 14px;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-family: 'Roboto Mono', monospace;
  font-size: 15px;
  transition: border-color 0.3s ease;
  background: #fafafa;
}

input:focus {
  outline: none;
  border-color: #B22222;
  box-shadow: 0 0 0 3px rgba(178, 34, 34, 0.1);
}

.grade-container {
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 6px;
  padding: 20px;
  margin: 20px 0;
}

.grade-item {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
  padding: 12px;
  background: white;
  border-radius: 4px;
  border-left: 4px solid #B22222;
}

.grade-item label { font-weight: 500; color: #333; flex: 1; margin: 0; }
.grade-item input[type="number"] { width: 70px; text-align: center; border: 2px solid #ddd; }
.grade-item button {
  width: 36px;
  height: 36px;
  padding: 0;
  font-size: 18px;
  font-weight: bold;
  margin: 0 2px;
  border-radius: 4px;
}

.grade-item .btn-mais { background: #28a745; color: white; }
.grade-item .btn-menos { background: #dc3545; color: white; }

.card-produto {
  background: white;
  border: 2px solid #e9ecef;
  border-left: 5px solid #B22222;
  border-radius: 6px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  position: relative;
  text-transform: uppercase;
  font-weight: 500;
}

.card-produto:hover {
  box-shadow: 0 8px 25px rgba(0,0,0,0.12);
  transform: translateY(-2px);
}

.card-produto-actions {
  position: absolute;
  top: 15px;
  right: 15px;
  display: flex;
  gap: 8px;
}

.card-produto h3 {
  font-size: 18px;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 12px;
  margin-right: 120px;
}

.card-produto p { 
  margin: 8px 0; 
  color: #555; 
  font-size: 14px;
  letter-spacing: 1px;
}

.card-produto .grade {
  font-size: 13px;
  color: #B22222;
  background: #fff5f5;
  padding: 12px 15px;
  border-radius: 4px;
  border-left: 4px solid #B22222;
  margin-top: 10px;
}

.sem-produtos {
  text-align: center;
  color: #666;
  font-style: italic;
  font-size: 16px;
  padding: 40px;
}

.botoes-cadastro {
  display: flex;
  justify-content: flex-end;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 2px solid #e9ecef;
}

@media (max-width: 768px) {
  .form-grid { grid-template-columns: 1fr; }
  .botoes-topo { flex-direction: column; }
  .card-produto-actions { position: static; justify-content: center; margin-top: 15px; }
  .card-produto h3 { margin-right: 0; text-align: center; }
}

.cabecalho-flex {
  display: flex;
  align-items: center;
  gap: 20px;
}

.logo-cabecalho {
  width: 80px;
  height: auto;
  background: white;
  padding: 6px;
  border-radius: 6px;
}

    </style>
  <!-- Tela Inicial -->
  <div id="tela-lista" class="tela">
    <img src="logo.png" class="logo-cabecalho">
  
  <div class="titulo-cabecalho">
    <h1>Recebimento de Produtos</h1>
    <div class="data-hora">
      <span id="data-atual"></span>
    </div>
  </div>
    </header>

    <div class="botoes-topo">
      <button id="btn-cadastrar">+ Cadastrar Produto</button>
      <button id="btn-salvar">üíæ Salvar</button>
      <button id="btn-imprimir">üñ®Ô∏è Imprimir</button>
      <button id="btn-download-pdf">üì• PDF</button>
      <button id="btn-limpar-tudo">üóëÔ∏è Limpar Tudo</button>
    </div>

    <div id="lista-produtos" class="lista-produtos"></div>
  </div>

  <!-- Tela de Cadastro/Edi√ß√£o -->
  <div id="tela-cadastro" class="tela" style="display: none;">
    <header class="cabecalho">
      <h1 id="titulo-cadastro">Novo Recebimento</h1>
      <button id="btn-voltar-cadastro" class="btn-voltar">‚Üê Voltar</button>
    </header>

    <form id="form-produto">
      <div class="form-grid">
        <div class="form-group">
          <label>Descri√ß√£o do Produto</label>
          <input type="text" id="descricao" required>
        </div>
        <div class="form-group">
          <label>Refer√™ncia</label>
          <input type="text" id="referencia" required>
        </div>
        <div class="form-group">
          <label>Cor</label>
          <input type="text" id="cor" required>
        </div>
        <div class="form-group full-width">
          <label>Tamanhos (separados por v√≠rgula)</label>
          <input type="text" id="tamanhos" placeholder="Ex: PP, P, M, G, GG ou 36, 38, 40...">
        </div>
      </div>

      <div id="grade-container" class="grade-container"></div>
      <div class="botoes-cadastro">
        <button type="submit" class="btn-primary" id="btn-submit">Adicionar Produto</button>
      </div>
    </form>
  </div>

  <!-- PDF Container -->
  <div id="pdf-container" style="display: none;"></div>

  <script>
    const telaLista = document.getElementById('tela-lista');
const telaCadastro = document.getElementById('tela-cadastro');
const btnCadastrar = document.getElementById('btn-cadastrar');
const btnSalvar = document.getElementById('btn-salvar');
const btnImprimir = document.getElementById('btn-imprimir');
const btnDownloadPdf = document.getElementById('btn-download-pdf');
const btnLimparTudo = document.getElementById('btn-limpar-tudo');
const btnVoltarCadastro = document.getElementById('btn-voltar-cadastro');
const formProduto = document.getElementById('form-produto');
const listaProdutos = document.getElementById('lista-produtos');
const gradeContainer = document.getElementById('grade-container');
const dataAtualEl = document.getElementById('data-atual');
const tituloCadastro = document.getElementById('titulo-cadastro');
const btnSubmit = document.getElementById('btn-submit');
const pdfContainer = document.getElementById('pdf-container');

let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
let produtoEditando = null;

// Data atual com auto-update
function atualizarData() {
  const agora = new Date();
  dataAtualEl.textContent = agora.toLocaleDateString('pt-BR', {
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
    hour: '2-digit', minute: '2-digit'
  });
}
atualizarData();
setInterval(atualizarData, 60000);

function mostrarTelaCadastro(editando = null) {
  telaLista.style.display = 'none';
  telaCadastro.style.display = 'block';
  formProduto.reset();
  gradeContainer.innerHTML = '';
  produtoEditando = editando;
  
  if (editando) {
    tituloCadastro.textContent = 'Editar Produto';
    btnSubmit.textContent = 'Atualizar Produto';
    document.getElementById('descricao').value = editando.descricao;
    document.getElementById('referencia').value = editando.referencia;
    document.getElementById('cor').value = editando.cor;
    
    // ‚úÖ CORRE√á√ÉO COMPLETA: Sincroniza√ß√£o perfeita dos tamanhos
    setTimeout(() => {
      // 1. Extrai TODOS os tamanhos √∫nicos do produto existente
      const tamanhosExistentes = new Set();
      const gradeItems = editando.grade.split(', ');
      
      gradeItems.forEach(item => {
        const tamanhoOriginal = item.split(':')[0].trim(); // "PP", "P", "M"
        tamanhosExistentes.add(tamanhoOriginal); // Mant√©m case original
      });
      
      // 2. Preenche campo tamanhos com case ORIGINAL
      const tamanhosStr = Array.from(tamanhosExistentes).join(', ');
      const inputTamanhos = document.getElementById('tamanhos');
      inputTamanhos.value = tamanhosStr;
      
      // 3. Gera a grade
      gerarGrade();
      
      // 4. PREENCHE AS QUANTIDADES com DELAY garantido
      setTimeout(() => {
        gradeItems.forEach(item => {
          const [tamanhoOriginal, qtdStr] = item.split(':');
          const quantidade = parseInt(qtdStr?.trim()) || 0;
          
          // Procura input EXATAMENTE pelo tamanho original (case sensitive)
          const input = gradeContainer.querySelector(`input[data-tamanho="${tamanhoOriginal.trim()}"]`);
          
          if (input && quantidade > 0) {
            input.value = quantidade;
          }
        });
        
        console.log('‚úÖ Tamanhos sincronizados:', tamanhosStr);
      }, 200); // Delay maior para garantir renderiza√ß√£o
      
    }, 100);
    
  } else {
    tituloCadastro.textContent = 'Novo Recebimento';
    btnSubmit.textContent = 'Adicionar Produto';
  }
}



function mostrarTelaLista() {
  telaLista.style.display = 'block';
  telaCadastro.style.display = 'none';
  atualizarLista();
}

function atualizarLista() {
  listaProdutos.innerHTML = '';
  if (produtos.length === 0) {
    listaProdutos.innerHTML = '<p class="sem-produtos">Nenhum produto recebido ainda. <br><small>Clique em "+ Cadastrar Produto" para come√ßar.</small></p>';
    return;
  }
  
  produtos.forEach((produto, index) => {
    const card = document.createElement('div');
    card.className = 'card-produto';
    card.innerHTML = `
      <div class="card-produto-actions">
        <button class="btn-editar" data-index="${index}">Editar</button>
        <button class="btn-excluir" data-index="${index}">Excluir</button>
      </div>
      <h3>${produto.descricao.toUpperCase()}</h3>
      <p><strong>Refer√™ncia:</strong> ${produto.referencia.toUpperCase()}</p>
      <p><strong>Cor:</strong> ${produto.cor.toUpperCase()}</p>
      <p class="grade"><strong>Quantidades:</strong> ${produto.grade.toUpperCase()}</p>
    `;
    listaProdutos.appendChild(card);
  });

  document.querySelectorAll('.btn-editar, .btn-excluir').forEach(btn => {
    btn.addEventListener('click', function() {
      const index = parseInt(this.dataset.index);
      if (this.classList.contains('btn-editar')) {
        editarProduto(index);
      } else {
        excluirProduto(index);
      }
    });
  });
}

function gerarGrade() {
  gradeContainer.innerHTML = '';
  const tamanhosInput = document.getElementById('tamanhos').value.trim();
  if (!tamanhosInput) return;

  const tamanhos = tamanhosInput.split(',').map(t => t.trim()).filter(t => t);
  if (tamanhos.length === 0) return;

  tamanhos.forEach(tamanho => {
    const div = document.createElement('div');
    div.className = 'grade-item';
    div.innerHTML = `
      <label>${tamanho.toUpperCase()}:</label>
      <button type="button" class="btn-menos" data-tamanho="${tamanho}">‚àí</button>
      <input type="number" class="quantidade" data-tamanho="${tamanho}" value="0" min="0" max="999">
      <button type="button" class="btn-mais" data-tamanho="${tamanho}">+</button>
    `;
    gradeContainer.appendChild(div);
  });

  gradeContainer.querySelectorAll('.btn-mais, .btn-menos').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      const tamanho = this.dataset.tamanho;
      const input = gradeContainer.querySelector(`input[data-tamanho="${tamanho}"]`);
      if (!input) return;
      
      let valor = parseInt(input.value) || 0;
      if (this.classList.contains('btn-mais')) {
        input.value = Math.min(999, valor + 1);
      } else {
        input.value = Math.max(0, valor - 1);
      }
    });
  });

  gradeContainer.querySelectorAll('.quantidade').forEach(input => {
    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        this.blur();
      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        e.preventDefault();
      }
    });
  });
}

function editarProduto(index) {
  if (produtos[index]) {
    mostrarTelaCadastro(produtos[index]);
  }
}

function excluirProduto(index) {
  if (confirm(`Tem certeza que deseja excluir "${produtos[index]?.descricao || 'este produto'}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
    produtos.splice(index, 1);
    salvarDados();
    atualizarLista();
  }
}

function limparTudo() {
  if (confirm('‚ö†Ô∏è TEM CERTEZA que deseja APAGAR TODOS os produtos?\n\nEsta a√ß√£o N√ÉO pode ser desfeita e todos os dados ser√£o perdidos permanentemente.')) {
    produtos = [];
    localStorage.removeItem('produtos');
    atualizarLista();
    alert('üóëÔ∏è Todos os produtos foram exclu√≠dos.');
  }
}

function salvarDados() {
  localStorage.setItem('produtos', JSON.stringify(produtos));
}

function salvarConteudoPagina() {
  // ‚úÖ SALVAR: Salva todos os produtos no localStorage (backup completo)
  salvarDados();
  alert('üíæ Conte√∫do da p√°gina salvo com sucesso!\nOs produtos est√£o seguros no navegador.');
}

async function gerarPdfBase64() {
  if (produtos.length === 0) {
    alert('Nenhum produto para gerar PDF.');
    return null;
  }

  const dataHoje = new Date().toLocaleDateString('pt-BR');
  
  pdfContainer.innerHTML = `
  <div style="width: 595px; padding: 15px; font-family: 'Roboto Mono', monospace; font-size: 10px; color: #333;">
    
    <div style="
  display:flex;
  align-items:center;
  gap:12px;
  background:#8B0000;
  color:white;
  padding:10px;
  margin-bottom:10px;
">
  <img src="logo.png" style="
    width:60px;
    background:white;
    padding:4px;
    border-radius:4px;
  ">
  
  <div style="flex:1;text-align:center;">
    <div style="font-size:16px;font-weight:700;">
      RELAT√ìRIO DE RECEBIMENTO DE PRODUTOS
    </div>
    <div style="font-size:10px;opacity:0.9;">
      Shoe Mix Cal√ßados
    </div>
  </div>
</div>


    <div style="margin-bottom:10px;font-size:11px;text-align:center;">
      Total de produtos: <strong>${produtos.length}</strong> ‚Äî ${dataHoje}
    </div>

    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#f2f2f2;">
          <th style="border:1px solid #ccc;padding:6px;">#</th>
          <th style="border:1px solid #ccc;padding:6px;">Descri√ß√£o</th>
          <th style="border:1px solid #ccc;padding:6px;">Refer√™ncia</th>
          <th style="border:1px solid #ccc;padding:6px;">Cor</th>
          <th style="border:1px solid #ccc;padding:6px;">Quantidades</th>
        </tr>
      </thead>
      <tbody>
        ${produtos.map((p, i) => `
          <tr>
            <td style="border:1px solid #ccc;padding:6px;text-align:center;">${i + 1}</td>
            <td style="border:1px solid #ccc;padding:6px;">${p.descricao.toUpperCase()}</td>
            <td style="border:1px solid #ccc;padding:6px;">${p.referencia.toUpperCase()}</td>
            <td style="border:1px solid #ccc;padding:6px;">${p.cor.toUpperCase()}</td>
            <td style="border:1px solid #ccc;padding:6px;font-size:9px;">
              ${p.grade.toUpperCase()}
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>

    <div style="margin-top:15px;text-align:center;font-size:8px;color:#666;">
      Gerado em ${new Date().toLocaleString('pt-BR')}
    </div>
  </div>
`;


  pdfContainer.style.display = 'block';
  pdfContainer.style.position = 'absolute';
  pdfContainer.style.left = '-9999px';
  
  try {
    const canvas = await html2canvas(pdfContainer, {
      scale: 2,
      useCORS: true,
      backgroundColor: '#ffffff',
      logging: false,
      width: 595,
      height: 842,
      scrollX: 0,
      scrollY: 0
    });
    
    const imgData = canvas.toDataURL('image/png');
    const pdf = new window.jspdf.jsPDF('p', 'pt', 'a4');
    pdf.addImage(imgData, 'PNG', 0, 0, 595, 842);
    
    pdf.setFontSize(9);
    pdf.setTextColor(100);
    pdf.text(`P√°gina 1 de 1`, 297, 820, { align: 'center' });
    
    return pdf.output('blob');
  } catch (error) {
    console.error('Erro ao gerar PDF:', error);
    return null;
  } finally {
    pdfContainer.style.display = 'none';
    mostrarTelaLista();
  }
}

async function imprimirPdf() {
  // ‚úÖ IMPRIMIR: Abre impress√£o direta do PDF
  const pdfBlob = await gerarPdfBase64();
  if (pdfBlob) {
    const pdfUrl = URL.createObjectURL(pdfBlob);
    const printWindow = window.open(pdfUrl, '_blank');
    printWindow.onload = () => {
      printWindow.print();
      printWindow.onafterprint = () => {
        printWindow.close();
      };
    };
  }
}

async function baixarPdf() {
  // ‚úÖ BAIXAR: Gera e baixa PDF
  const pdfBlob = await gerarPdfBase64();
  if (pdfBlob) {
    const dataHoje = new Date().toLocaleDateString('pt-BR');
    const link = document.createElement('a');
    link.href = URL.createObjectURL(pdfBlob);
    link.download = `Recebimento_Produtos_${dataHoje.replace(/\//g, '-')}.pdf`;
    link.click();
  }
}

// Eventos principais
document.getElementById('tamanhos').addEventListener('input', gerarGrade);
btnCadastrar.addEventListener('click', () => mostrarTelaCadastro());
btnSalvar.addEventListener('click', salvarConteudoPagina);
btnImprimir.addEventListener('click', imprimirPdf);
btnDownloadPdf.addEventListener('click', baixarPdf);
btnLimparTudo.addEventListener('click', limparTudo);

btnVoltarCadastro.addEventListener('click', function() {
  if (formProduto.querySelector('.quantidade')?.value || 
      document.getElementById('descricao').value ||
      document.getElementById('referencia').value ||
      document.getElementById('cor').value) {
    if (!confirm('Deseja sair? Dados n√£o salvos ser√£o perdidos.')) return;
  }
  mostrarTelaLista();
});

formProduto.addEventListener('submit', function(e) {
  e.preventDefault();
  
  const descricao = document.getElementById('descricao').value.trim();
  const referencia = document.getElementById('referencia').value.trim();
  const cor = document.getElementById('cor').value.trim();
  
  if (!descricao || !referencia || !cor) {
    alert('Preencha todos os campos obrigat√≥rios.');
    return;
  }

  const inputs = gradeContainer.querySelectorAll('.quantidade');
  const gradeArray = [];
  
  let temQuantidadeValida = false;
  inputs.forEach(input => {
    const tamanho = input.dataset.tamanho;
    const quantidade = parseInt(input.value) || 0;
    if (quantidade > 0) {
      gradeArray.push(`${tamanho.toUpperCase()}: ${quantidade}`);
      temQuantidadeValida = true;
    }
  });

  if (!temQuantidadeValida) {
    alert('Adicione pelo menos uma quantidade maior que zero.');
    return;
  }

  const grade = gradeArray.join(', ');
  const produtoData = { descricao, referencia, cor, grade };

  const produtoExistente = produtos.find(p => 
    p.descricao.toLowerCase() === descricao.toLowerCase() &&
    p.referencia.toLowerCase() === referencia.toLowerCase() &&
    p.cor.toLowerCase() === cor.toLowerCase()
  );

  if (produtoEditando) {
    const index = produtos.indexOf(produtoEditando);
    if (index !== -1) {
      produtos[index] = produtoData;
      alert('‚úÖ Produto atualizado com sucesso!');
    }
  } else if (produtoExistente) {
    const gradeAtual = produtoExistente.grade.split(', ').map(g => {
      const [tamanho, qtd] = g.split(': ');
      return { tamanho: tamanho.trim(), quantidade: parseInt(qtd) || 0 };
    });

    const gradeNova = gradeArray.map(g => {
      const [tamanho, qtd] = g.split(': ');
      return { tamanho: tamanho.trim(), quantidade: parseInt(qtd) || 0 };
    });

    const gradeFinal = new Map();
    gradeAtual.forEach(item => {
      gradeFinal.set(item.tamanho, item.quantidade);
    });
    gradeNova.forEach(item => {
      const atual = gradeFinal.get(item.tamanho) || 0;
      gradeFinal.set(item.tamanho, atual + item.quantidade);
    });

    const gradeSomada = Array.from(gradeFinal.entries())
      .map(([tamanho, qtd]) => `${tamanho}: ${qtd}`)
      .join(', ');

    produtoExistente.grade = gradeSomada;
    salvarDados();
    alert(`‚úÖ Produto existente atualizado!\nQuantidades somadas ao item "${descricao}".`);
  } else {
    produtos.push(produtoData);
    alert('‚úÖ Produto recebido com sucesso!');
  }

  salvarDados();
  mostrarTelaLista();
  produtoEditando = null;
});

// Inicializa√ß√£o
atualizarLista();

  </script>
</body>
</html>
